---
layout:     post
title:      "WSLç½‘ç»œä»£ç†é…ç½®"
subtitle:   "2025-02-20"
date:       2025-02-20
author:     "Sun"

catalog: true

---
# WSL ä»£ç†é…ç½®æŒ‡å—

## 1. WSL æ“ä½œ

### 1.1 èŽ·å–ä¸»æœºçš„å®žé™… IP åœ°å€

åœ¨ WSL ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒèŽ·å–ä¸»æœºçš„å®žé™… IP åœ°å€ï¼ˆ**è€Œä¸æ˜¯ DNS åœ°å€**ï¼‰ï¼š

```bash
ip route | grep default | awk '{print $3}'
```

è¾“å‡ºå¯èƒ½ç±»ä¼¼äºŽ `192.168.1.1` æˆ–å…¶ä»– **NAT åœ°å€**ã€‚

> **æ£€æŸ¥ä»£ç†æœåŠ¡æ˜¯å¦å¯ç”¨**
> 
> ç¡®ä¿ WSL å¯ä»¥é€šè¿‡è¯¥ IP åœ°å€è®¿é—®ä¸»æœºä»£ç†ï¼Œä¾‹å¦‚ï¼š
> 
> ```bash
> ping 192.168.1.1:7890  # ç¤ºä¾‹
> ```

---

### 1.2 ä¿®æ”¹ WSL çš„ä»£ç†é…ç½®

åœ¨ `~/.bashrc` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```bash
host_ip=$(ip route | grep default | awk '{print $3}')
export ALL_PROXY=http://$host_ip:7890
```

#### è§£é‡Šï¼š
- `host_ip=$(ip route | grep default | awk '{print $3}')`ï¼šæ¯æ¬¡ WSL å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨èŽ·å–ä¸»æœºçš„å®žé™… IP åœ°å€ï¼ˆå› é‡‡ç”¨ NAT è¿žæŽ¥ï¼‰ã€‚
- `export ALL_PROXY=http://$host_ip:7890`ï¼šè®¾ç½® `ALL_PROXY` å˜é‡ï¼Œä½¿ WSL é€šè¿‡ä¸»æœºä»£ç†è®¿é—®ç½‘ç»œã€‚

#### **åº”ç”¨æ›´æ”¹**
è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä½¿æ›´æ”¹ç”Ÿæ•ˆï¼š

```bash
source ~/.bashrc
```

---

### 1.3 æµ‹è¯•ä»£ç†æ˜¯å¦å·¥ä½œ

ä½¿ç”¨ `curl` æµ‹è¯•ä»£ç†æ˜¯å¦ç”Ÿæ•ˆï¼š

```bash
curl -I --proxy http://$host_ip:7890 http://google.com
```

å¦‚æžœè¿”å›ž **HTTP å¤´ä¿¡æ¯**ï¼Œè¯´æ˜Žä»£ç†å·²æ­£å¸¸å·¥ä½œã€‚

---

### 1.4 é…ç½® Clash ç›‘å¬åœ°å€

ç¡®ä¿ Clash é…ç½®å…è®¸å±€åŸŸç½‘è®¿é—®ï¼Œå¹¶ç›‘å¬æ­£ç¡®çš„ IP åœ°å€ï¼š

1. æ‰“å¼€ Clash é…ç½®æ–‡ä»¶ï¼ˆ`config.yaml` æˆ– UI é…ç½®ï¼‰ã€‚
2. ç¡®ä¿ä»¥ä¸‹å†…å®¹æ­£ç¡®è®¾ç½®ï¼š

```yaml
allow-lan: true
external-controller: 0.0.0.0:7890
```

3. **é‡å¯ Clash**ï¼Œä»¥åº”ç”¨æ–°çš„è®¾ç½®ã€‚

---

### 1.5 éªŒè¯ Clash çš„ç›‘å¬çŠ¶æ€

åœ¨ä¸»æœºï¼ˆWindowsï¼‰ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ£€æŸ¥ Clash æ˜¯å¦ç›‘å¬ `7890` ç«¯å£ï¼š

```bash
netstat -an | findstr 7890
```

å¦‚æžœè¾“å‡ºæ˜¾ç¤º `0.0.0.0:7890` æˆ– **ä¸»æœºçš„å®žé™… IP åœ°å€**ï¼Œè¯´æ˜Žè®¾ç½®æ­£ç¡®ã€‚

---

### 1.6 ç¡®ä¿ä¸»æœºé˜²ç«å¢™æœªé˜»æ­¢ WSL

- ç¡®ä¿ **Windows é˜²ç«å¢™** æˆ– **æ€æ¯’è½¯ä»¶** **æœªé˜»æ­¢ WSL è®¿é—® 7890 ç«¯å£**ã€‚
- å¦‚æžœé˜²ç«å¢™å·²å¯ç”¨ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªè§„åˆ™ **å…è®¸ WSL è®¿é—® 7890 ç«¯å£**ã€‚

---

## 2. Windows ä»£ç†è®¾ç½®

ç›®å‰è¿˜ä¸æ¸…æ¥šä¸ºä½•æ‰‹åŠ¨å…³é—­ä»£ç†åŽï¼ŒWSL ä»ç„¶å¯ä»¥ä½¿ç”¨ä»£ç†ã€‚

ðŸ“Œ **ç›¸å…³è®¾ç½®**ï¼š
> **Windows ä»£ç†æœåŠ¡å™¨è®¾ç½®ï¼ˆå¾…è¡¥å……ï¼‰**
> 
> ![å›¾1. Windows ä»£ç†æœåŠ¡å™¨è®¾ç½®](/home/sunm01/sun-blog/_posts/pic/Windows_Proxy_Setting.png)

---

## 3. Clash ç›¸å…³æ“ä½œ

åœ¨ä½¿ç”¨ Clash ä»£ç†æ—¶ï¼Œéœ€æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

- **è®°ä½ä»£ç†ç«¯å£å·**ï¼ˆå¦‚ `7890`ï¼‰ã€‚
- **å¯ç”¨å±€åŸŸç½‘è¿žæŽ¥**ï¼Œç¡®ä¿ WSL å¯ä»¥è®¿é—®ä»£ç†ã€‚

ðŸ“Œ **ç›¸å…³è®¾ç½®**ï¼š
> **Clash ç«¯å£ + å±€åŸŸç½‘è¿žæŽ¥**
> 
> ![å›¾2. Clash è®¾ç½®](/home/sunm01/sun-blog/_posts/pic/Clashè®¾ç½®.png)
